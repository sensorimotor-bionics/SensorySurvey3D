
% 2D vs 3D skeletal plotting and alignment tests

%% landmark definitions
landmarks = {"Tend","Tpip","Tmcp",...
    "Iend","Idip","Ipip","Imcp",...
    "Mend","Mdip","Mpip","Mmcp",...
    "Rend","Rdip","Rpip","Rmcp",...
    "Pend","Pdip","Ppip","Pmcp",...
    "MpP","MpD","WuT","WuP", "EoW"};

landmark_2D = struct("Tend", [-0.3973161280155182, -0.09739081561565399, 0.008577486500144005],...
                    "Tpip", [-0.2889059782028198, -0.1601298600435257, 0.0008937307284213603],...
                    "Tmcp", [-0.1731044054031372, -0.29852038621902466, -0.0030092033557593822],...
                    "Iend", [-0.20343202352523804, 0.2659095823764801, 0.0052677933126688],...
                    "Idip", [-0.16815689206123352, 0.15536479651927948, -0.0019431354012340307],...
                    "Ipip", [-0.13614414632320404, 0.05264347046613693, -0.0019431463442742825],...
                    "Imcp", [-0.09463842958211899, -0.09171192348003387, 0.0009222878143191338],...
                    "Mend", [0.014180099591612816, 0.33758774399757385, 0.00526772066950798],...
                    "Mdip", [0.002082435879856348, 0.20410408079624176, -0.0019431916298344731],...
                    "Mpip", [0.0019956817850470543, 0.09231160581111908, -0.0019431918626651168],...
                    "Mmcp", [-0.01149352453649044, -0.08220024406909943, 0.008189394138753414],...
                    "Rend", [0.1625347137451172, 0.29255402088165283, 0.00526767410337925],...
                    "Rdip", [0.14687740802764893, 0.1652742624282837, -0.001943238195963204],...
                    "Rpip", [0.12747149169445038, 0.08470387011766434, -0.0019432312110438943],...
                    "Rmcp", [0.09871725738048553, -0.10498759150505066, 0.008189357817173004],...
                    "Pend", [0.31460586190223694, 0.1387959122657776, 0.005267622880637646],...
                    "Pdip", [0.2664164900779724, 0.0453401654958725, -0.001943276496604085],...
                    "Ppip", [0.23313823342323303, -0.017573753371834755, -0.0019432657863944769],...
                    "Pmcp", [0.1747056543827057, -0.14175035059452057, 0.00092220091028139],...
                    "MpP", [0.005719088949263096, -0.28767216205596924, -0.021619586274027824],...
                    "MpD", [0.033343859016895294, -0.25342318415641785, 0.07902956753969193],...
                    "WuT", [-0.19626854360103607, -0.3809897303581238, -0.003009192878380418],...
                    "WuP", [0.16042210161685944, -0.49611347913742065, -0.0030093092937022448],...
                    "EoW", [-0.0036766380071640015, -0.6203309297561646, -0.0030092555098235607]);

landmark_3D = struct("Tend", [0.011944269761443138, -0.025434358045458794, 0.14793965220451355],...
                    "Tpip", [0.02625223994255066, -0.005346675869077444, 0.10906960815191269],...
                    "Tmcp", [0.04830366000533104, 0.028626257553696632, 0.05326266214251518],...
                    "Iend", [-0.09803204983472824, -0.11361753940582275, 0.09060187637805939],...
                    "Idip", [-0.08436223119497299, -0.07808545976877213, 0.07706764340400696],...
                    "Ipip", [-0.06497237086296082, -0.04143152013421059, 0.062459029257297516],...
                    "Imcp", [-0.0282317865639925, 0.003915929235517979, 0.04234475642442703],...
                    "Mend", [-0.11940792948007584, -0.1269465535879135, 0.04681067541241646],...
                    "Mdip", [-0.10010241717100143, -0.08598123490810394, 0.035041313618421555],...
                    "Mpip", [-0.08144111186265945, -0.05056745558977127, 0.024615518748760223],...
                    "Mmcp", [-0.03732520714402199, -0.0032152137719094753, 0.00855743046849966],...
                    "Rend", [-0.12056756019592285, -0.12936486303806305, -0.011717624962329865],...
                    "Rdip", [-0.10277992486953735, -0.09457283467054367, -0.01590607687830925],...
                    "Rpip", [-0.07978403568267822, -0.05456552281975746, -0.019512664526700974],...
                    "Rmcp", [-0.03639180585741997, -0.008907418698072433, -0.024278538301587105],...
                    "Pend", [-0.08219294250011444, -0.11728043854236603, -0.057242635637521744],...
                    "Pdip", [-0.07266569137573242, -0.0835917666554451, -0.060377899557352066],...
                    "Ppip", [-0.058815956115722656, -0.0500861257314682, -0.059373967349529266],...
                    "Pmcp", [-0.028035607188940048, -0.012062869034707546, -0.05384033918380737],...
                    "MpP", [0.03106795810163021, 0.005717303138226271, -0.011161050759255886],...
                    "MpD", [-0.0062567004933953285, 0.048727069050073624, -0.017364144325256348],...
                    "WuT", [0.09697737544775009, 0.07979375869035721, 0.010476600378751755],...
                    "WuP", [0.06988106667995453, 0.05041353031992912, -0.09531185030937195],...
                    "EoW", [0.1162354052066803, 0.09213633835315704, -0.058112263679504395]);

%% plotting 3d model landmarks

all_3d = [];

figure
title('3D Model Landmarks')
hold on
which_landmarks = {"Tpip","Tmcp",...
    "Idip","Ipip","Imcp",...
    "Mdip","Mpip","Mmcp",...
    "Rdip","Rpip","Rmcp",...
    "Pdip","Ppip","Pmcp"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_3D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'r.','MarkerSize',30)
    all_3d = cat(1,all_3d,this_landmark);
end

which_landmarks = {"Tend","Iend","Mend","Rend","Pend"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_3D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'b.','MarkerSize',30)
    all_3d = cat(1,all_3d,this_landmark);
end

which_landmarks = {"MpP","MpD","WuT","WuP", "EoW"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_3D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'g.','MarkerSize',30)
    all_3d = cat(1,all_3d,this_landmark);
end

axis equal

%% plotting 2d model landmarks

all_2d = [];

figure
title('2D Model Landmarks')
hold on
which_landmarks = {"Tpip","Tmcp",...
    "Idip","Ipip","Imcp",...
    "Mdip","Mpip","Mmcp",...
    "Rdip","Rpip","Rmcp",...
    "Pdip","Ppip","Pmcp"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_2D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'r.','MarkerSize',30)
    all_2d = cat(1,all_2d,this_landmark);
end

which_landmarks = {"Tend","Iend","Mend","Rend","Pend"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_2D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'b.','MarkerSize',30)
    all_2d = cat(1,all_2d,this_landmark);
end

which_landmarks = {"MpP","MpD","WuT","WuP","EoW"};

for ii = 1:length(which_landmarks)
    this_landmark = landmark_2D.(which_landmarks{ii});
    plot3(this_landmark(1),this_landmark(2),this_landmark(3),'g.','MarkerSize',30)
    all_2d = cat(1,all_2d,this_landmark);
end

axis equal

%% procrustin'

[d,Z,transform] = procrustes(all_2d,all_3d);

% Z = TRANSFORM.b * Y * TRANSFORM.T + TRANSFORM.c

figure
hold on
plot3(all_2d(:,1),all_2d(:,2),all_2d(:,3),'r.','MarkerSize',30)
axis equal
plot3(Z(:,1),Z(:,2),Z(:,3),'b.','MarkerSize',30)

% start with ordinary procrustes transformation calculation, then overlay
% the two whole meshes.

% then, work out the finger-straightening ish, etc.
% or possibly, straighten fingers first